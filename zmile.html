<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a1a1a">
  <title>Zmile Checkpoint</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #121212;
      min-height: 100vh;
      padding: 16px;
      color: #e0e0e0;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
    }

    /* Logo */
    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 20px 0;
      margin-bottom: 16px;
    }

    .logo-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon svg {
      width: 28px;
      height: 28px;
      color: white;
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: #fff;
    }

    .logo-text span {
      color: #4CAF50;
    }

    /* Trip Info Card */
    .trip-info {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      border: 1px solid #2a2a2a;
    }

    .trip-info-header {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #888;
      margin-bottom: 12px;
    }

    .trip-info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .trip-info-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .trip-info-item.full-width {
      grid-column: 1 / -1;
    }

    .trip-info-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      color: #666;
      letter-spacing: 0.3px;
    }

    .trip-info-value {
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
    }

    /* Hidden file input */
    #cameraInput {
      display: none;
    }

    /* Take Photo Button - Large */
    .capture-btn {
      width: 100%;
      padding: 32px 24px;
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      border: none;
      border-radius: 16px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
    }

    .capture-btn:active {
      transform: scale(0.98);
      box-shadow: 0 2px 10px rgba(76, 175, 80, 0.2);
    }

    .capture-btn svg {
      width: 48px;
      height: 48px;
    }

    .capture-btn-hint {
      font-size: 0.85rem;
      font-weight: 400;
      opacity: 0.85;
    }

    .capture-btn.has-photo {
      padding: 16px 24px;
      flex-direction: row;
      background: #2a2a2a;
      box-shadow: none;
    }

    .capture-btn.has-photo svg {
      width: 24px;
      height: 24px;
    }

    .capture-btn.has-photo .capture-btn-hint {
      display: none;
    }

    /* Preview Section */
    .preview-section {
      display: none;
      margin-top: 20px;
    }

    .preview-section.active {
      display: block;
    }

    .preview-container {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #2a2a2a;
    }

    /* Image Label */
    .image-label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #2a2a2a;
    }

    .image-label-icon {
      width: 32px;
      height: 32px;
      background: rgba(76, 175, 80, 0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-label-icon svg {
      width: 18px;
      height: 18px;
      color: #4CAF50;
    }

    .image-label-text {
      flex: 1;
    }

    .image-label-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #fff;
    }

    .image-label-desc {
      font-size: 0.75rem;
      color: #888;
      margin-top: 2px;
    }

    .thumbnail-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 4/3;
      border-radius: 10px;
      overflow: hidden;
      background: #2a2a2a;
    }

    .thumbnail {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .success-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(76, 175, 80, 0.9);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .success-badge svg {
      width: 14px;
      height: 14px;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .btn-secondary {
      flex: 1;
      padding: 14px 16px;
      font-size: 0.95rem;
      font-weight: 500;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s;
      border: none;
    }

    .btn-retake {
      background: #2a2a2a;
      color: #fff;
    }

    .btn-retake:active {
      background: #333;
    }

    .btn-clear {
      background: rgba(239, 83, 80, 0.15);
      color: #ef5350;
    }

    .btn-clear:active {
      background: rgba(239, 83, 80, 0.25);
    }

    /* Submit Button */
    .submit-btn {
      width: 100%;
      margin-top: 24px;
      padding: 18px 24px;
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #2196F3, #1565C0);
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 4px 20px rgba(33, 150, 243, 0.3);
    }

    .submit-btn:active {
      transform: scale(0.98);
    }

    .submit-btn:disabled {
      background: #2a2a2a;
      color: #666;
      box-shadow: none;
      cursor: not-allowed;
    }

    /* Footer spacing for mobile */
    .footer-spacer {
      height: 40px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo -->
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M9 11l3 3L22 4"/>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
        </svg>
      </div>
      <div class="logo-text">Zmile <span>Checkpoint</span></div>
    </div>

    <!-- Trip Info -->
    <div class="trip-info">
      <div class="trip-info-header">Load Information</div>
      <div class="trip-info-grid">
        <div class="trip-info-item">
          <span class="trip-info-label">Trip #</span>
          <span class="trip-info-value">TRP-284719</span>
        </div>
        <div class="trip-info-item">
          <span class="trip-info-label">Trailer #</span>
          <span class="trip-info-value">ABCD-531092</span>
        </div>
        <div class="trip-info-item full-width">
          <span class="trip-info-label">Driver</span>
          <span class="trip-info-value">Marcus Johnson</span>
        </div>
      </div>
    </div>

    <!-- Hidden file input -->
    <input 
      type="file" 
      id="cameraInput" 
      accept="image/*" 
      capture="environment"
    >

    <!-- Take Photo Button -->
    <button class="capture-btn" id="captureBtn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
        <circle cx="12" cy="13" r="4"/>
      </svg>
      <span>Trailer Condition Photo</span>
      <span class="capture-btn-hint">Tap to open camera</span>
    </button>

    <!-- Preview Section -->
    <div class="preview-section" id="previewSection">
      <div class="preview-container">
        <div class="image-label">
          <div class="image-label-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
          </div>
          <div class="image-label-text">
            <div class="image-label-title">Trailer Condition Photo</div>
            <div class="image-label-desc">Document any damage or current condition</div>
          </div>
        </div>

        <div class="thumbnail-wrapper">
          <img id="thumbnail" class="thumbnail" src="" alt="Captured photo">
          <div class="success-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            Captured
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn-secondary btn-retake" id="retakeBtn">
            Retake
          </button>
          <button class="btn-secondary btn-clear" id="clearBtn">
            Clear
          </button>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <button class="submit-btn" id="submitBtn" disabled>
      Submit Checkpoint
    </button>

    <div class="footer-spacer"></div>
  </div>

  <script>
    // Initialize Telegram Web App if available
    if (window.Telegram && Telegram.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
      
      // Match Telegram theme if available
      document.body.style.background = Telegram.WebApp.backgroundColor || '#121212';
    }

    // Elements
    const cameraInput = document.getElementById('cameraInput');
    const captureBtn = document.getElementById('captureBtn');
    const previewSection = document.getElementById('previewSection');
    const thumbnail = document.getElementById('thumbnail');
    const retakeBtn = document.getElementById('retakeBtn');
    const clearBtn = document.getElementById('clearBtn');
    const submitBtn = document.getElementById('submitBtn');

    // Store the captured image data
    let capturedImageData = null;

    // Open camera when capture button clicked
    captureBtn.addEventListener('click', () => {
      cameraInput.click();
    });

    // Handle file selection (photo taken)
    cameraInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        
        reader.onload = (event) => {
          capturedImageData = event.target.result;
          
          // Save to localStorage
          try {
            localStorage.setItem('capturedPhoto', capturedImageData);
          } catch (err) {
            console.log('localStorage not available:', err);
          }
          
          // Show preview
          thumbnail.src = capturedImageData;
          previewSection.classList.add('active');
          submitBtn.disabled = false;
          
          // Update capture button to smaller version
          captureBtn.classList.add('has-photo');
          captureBtn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            <span>Take Another Photo</span>
          `;
        };
        
        reader.readAsDataURL(file);
      }
    });

    // Retake photo
    retakeBtn.addEventListener('click', () => {
      cameraInput.value = '';
      cameraInput.click();
    });

    // Clear photo
    clearBtn.addEventListener('click', () => {
      capturedImageData = null;
      thumbnail.src = '';
      previewSection.classList.remove('active');
      submitBtn.disabled = true;
      cameraInput.value = '';
      
      // Clear from localStorage
      try {
        localStorage.removeItem('capturedPhoto');
      } catch (err) {
        console.log('localStorage not available:', err);
      }
      
      // Reset capture button
      captureBtn.classList.remove('has-photo');
      captureBtn.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
          <circle cx="12" cy="13" r="4"/>
        </svg>
        <span>Trailer Condition Photo</span>
        <span class="capture-btn-hint">Tap to open camera</span>
      `;
    });

    // Submit button
    submitBtn.addEventListener('click', () => {
      console.log('Submit clicked. Image data:', capturedImageData ? 'Present' : 'None');
    });

    // Load saved photo on page load
    window.addEventListener('load', () => {
      try {
        const savedPhoto = localStorage.getItem('capturedPhoto');
        if (savedPhoto) {
          capturedImageData = savedPhoto;
          thumbnail.src = capturedImageData;
          previewSection.classList.add('active');
          submitBtn.disabled = false;
          captureBtn.classList.add('has-photo');
          captureBtn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            <span>Take Another Photo</span>
          `;
        }
      } catch (err) {
        console.log('localStorage not available:', err);
      }
    });
  </script>
</body>
</html>
